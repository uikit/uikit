/*! UIkit 2.6.0 | http://www.getuikit.com | (c) 2014 YOOtheme | MIT License */

!function(a){"function"==typeof define&&define.amd&&define("uikit-htmleditor",["uikit"],function(){return jQuery.UIkit.htmleditor||a(window,window.jQuery,window.jQuery.UIkit)}),window&&window.jQuery&&window.jQuery.UIkit&&a(window,window.jQuery,window.jQuery.UIkit)}(function(a,b,c){var d=function(a,c){var e=b(a);e.data("htmleditor")||(this.element=e,this.options=b.extend(!0,{},d.defaults,c),this.marked=this.options.marked||marked,this.CodeMirror=this.options.CodeMirror||CodeMirror,this.init(),this.element.data("htmleditor",this))};b.extend(d.prototype,{init:function(){var a=this,e=d.template;this.options.markdown&&(this.options.codemirror.mode="gfm"),e=e.replace(/\{\:lblPreview\}/g,this.options.lblPreview),e=e.replace(/\{\:lblCodeview\}/g,this.options.markdown?"Markdown":this.options.lblCodeview),this.htmleditor=b(e),this.content=this.htmleditor.find(".uk-htmleditor-content"),this.toolbar=this.htmleditor.find(".uk-htmleditor-toolbar"),this.preview=this.htmleditor.find(".uk-htmleditor-preview").children().eq(0),this.code=this.htmleditor.find(".uk-htmleditor-code"),this.element.before(this.htmleditor).appendTo(this.code),this.editor=this.CodeMirror.fromTextArea(this.element[0],this.options.codemirror),this.editor.htmleditor=this,this.editor.on("change",function(){var b=function(){a.render()};return c.Utils.debounce(b,150)}()),this.code.find(".CodeMirror").css("height",this.options.height),b(window).on("resize",c.Utils.debounce(function(){a.fit()},200));var f=a.preview.parent(),g=this.code.find(".CodeMirror-sizer"),h=this.code.find(".CodeMirror-scroll").on("scroll",c.Utils.debounce(function(){if("tab"!=a.htmleditor.attr("data-mode")){var b=g.height()-h.height(),c=f[0].scrollHeight-f.height(),d=c/b,e=h.scrollTop()*d;f.scrollTop(e)}},10));this.htmleditor.on("click",".uk-htmleditor-button-code, .uk-htmleditor-button-preview",function(c){c.preventDefault(),"tab"==a.htmleditor.attr("data-mode")&&(a.htmleditor.find(".uk-htmleditor-button-code, .uk-htmleditor-button-preview").removeClass("uk-active").filter(this).addClass("uk-active"),a.activetab=b(this).hasClass("uk-htmleditor-button-code")?"code":"preview",a.htmleditor.attr("data-active-tab",a.activetab))}),this.htmleditor.on("click","a[data-htmleditor-cmd]",function(){var c=b(this).data("htmleditorCmd");!c||!d.commands[c]||a.activetab&&"code"!=a.activetab&&"fullscreen"!=c||d.commands[c].action.apply(a,[a.editor])}),this.preview.parent().css("height",this.code.height()),this.options.autocomplete&&this.CodeMirror.showHint&&this.CodeMirror.hint&&this.CodeMirror.hint.html&&this.editor.on("inputRead",c.Utils.debounce(function(){var b=a.editor.getDoc(),c=b.getCursor(),d=a.CodeMirror.innerMode(a.editor.getMode(),a.editor.getTokenAt(c).state).mode.name;if("xml"==d){var e=a.editor.getCursor(),f=a.editor.getTokenAt(e);("<"==f.string.charAt(0)||"attribute"==f.type)&&a.CodeMirror.showHint(a.editor,a.CodeMirror.hint.html,{completeSingle:!1})}},100)),this.element.on({enableMarkdown:function(){a.enableMarkdown()},disableMarkdown:function(){a.disableMarkdown()}}),this.redraw()},applyPlugins:function(){var a=this,b=this.options.plugins||[],c=d.plugins;if(this.markers={},b.length){var e=this.currentvalue.split("\n");b.forEach(function(a){this.markers[a]=[]},this);for(var f=0,g=e.length;g>f;f++)!function(d){b.forEach(function(b){var f=0;e[d]=e[d].replace(c[b].identifier,function(){var e=c[b].cb({editor:a,found:arguments,line:d,pos:f++,uid:[b,d,f,(new Date).getTime()+"RAND"+Math.ceil(1e5*Math.random())].join("-"),replace:function(a){var b=this.editor.editor.getLine(this.line),c=b.indexOf(this.found[0]);end=c+this.found[0].length,this.editor.editor.replaceRange(a,{line:this.line,ch:c},{line:this.line,ch:end})}});return e})})}(f);this.currentvalue=e.join("\n")}},_buildtoolbar:function(){if(this.options.toolbar&&this.options.toolbar.length){var a=this,b=[];this.toolbar.empty(),this.editor.removeKeyMap("htmleditor"),this.options.toolbar.forEach(function(c){if(d.commands[c]){var e=d.commands[c].title?d.commands[c].title:c;b.push('<li><a data-htmleditor-cmd="'+c+'" title="'+e+'" data-uk-tooltip>'+d.commands[c].label+"</a></li>"),d.commands[c].shortcut&&a.registerShortcut(d.commands[c].shortcut,d.commands[c].action)}}),this.toolbar.html(b.join("\n"))}},fit:function(){var a=this.options.mode;"split"==a&&this.htmleditor.width()<this.options.maxsplitsize&&(a="tab"),"tab"==a&&(this.activetab||(this.activetab="code",this.htmleditor.attr("data-active-tab",this.activetab)),this.htmleditor.find(".uk-htmleditor-button-code, .uk-htmleditor-button-preview").removeClass("uk-active").filter("code"==this.activetab?".uk-htmleditor-button-code":".uk-htmleditor-button-preview").addClass("uk-active")),this.editor.refresh(),this.preview.parent().css("height",this.code.height()),this.htmleditor.attr("data-mode",a)},redraw:function(){this._buildtoolbar(),this.render(),this.fit()},registerShortcut:function(a,c){for(var d=this,e=!1,f=this.editor.state.keyMaps,g=0;g<f.length;++g)if(f[g]&&"htmleditor"==f[g].name){e=f[g];break}e||(e={name:"htmleditor"},this.editor.addKeyMap(e)),a=b.isArray(a)?a:[a];for(var g=0,h=a.length;h>g;g++)e[a[g]]=function(){c.apply(d,[d.editor])}},getMode:function(){if("gfm"==this.editor.options.mode){var a=this.editor.getDoc().getCursor();return this.editor.getTokenAt(a).state.base.htmlState?"html":"markdown"}return"html"},render:function(){var a=this;if(this.currentvalue=this.editor.getValue(),!this.currentvalue)return this.element.val(""),void this.preview.html("");if(this.element.trigger("htmleditor-before",[this]),this.applyPlugins(),"gfm"==this.editor.options.mode&&this.marked)this.marked.setOptions(this.options.markedOptions),this.marked(a.currentvalue,function(b,c){if(b)throw b;a.preview.html(c),a.element.val(a.editor.getValue()).trigger("htmleditor-update",[a])});else{var c=b.parseHTML(a.currentvalue);c&&c.length&&(this.preview.html(c),this.element.val(this.editor.getValue()).trigger("htmleditor-update",[a]))}},enableMarkdown:function(){this.editor.setOption("mode","gfm"),this.htmleditor.find(".uk-htmleditor-button-code a").html("Markdown"),this.render()},disableMarkdown:function(){this.editor.setOption("mode","htmlmixed"),this.htmleditor.find(".uk-htmleditor-button-code a").html(this.options.lblCodeview),this.render()}});var e=function(a,b){var c=b.getSelection();if(!c.length){for(var d=b.getCursor(),e=b.getLine(d.line),f=d.ch,g=f;g<e.length&&/[\w$]+/.test(e.charAt(g));)++g;for(;f&&/[\w$]+/.test(e.charAt(f-1));)--f;var h=f!=g&&e.slice(f,g);h&&(b.setSelection({line:d.line,ch:f},{line:d.line,ch:g}),c=h)}var i=a.replace("$1",c);b.replaceSelection(i,"end"),b.focus()},f=function(a,b){var c=b.getDoc().getCursor(),d=b.getLine(c.line),e=a.replace("$1",d);b.replaceRange(e,{line:c.line,ch:0},{line:c.line,ch:d.length}),b.setCursor({line:c.line,ch:e.length}),b.focus()};return d.baseReplacer=e,d.lineReplacer=f,d.commands={fullscreen:{title:"Fullscreen",label:'<i class="uk-icon-expand"></i>',action:function(a){a.htmleditor.htmleditor.toggleClass("uk-htmleditor-fullscreen");var b=a.getWrapperElement();if(a.htmleditor.htmleditor.hasClass("uk-htmleditor-fullscreen"))a.state.fullScreenRestore={scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset,width:b.style.width,height:b.style.height},b.style.width="",b.style.height=a.htmleditor.content.height()+"px",document.documentElement.style.overflow="hidden";else{document.documentElement.style.overflow="";var c=a.state.fullScreenRestore;b.style.width=c.width,b.style.height=c.height,window.scrollTo(c.scrollLeft,c.scrollTop)}setTimeout(function(){a.htmleditor.fit()},10)}},bold:{title:"Bold",label:'<i class="uk-icon-bold"></i>',shortcut:["Ctrl-B","Cmd-B"],action:function(a){e("html"==this.getMode()?"<strong>$1</strong>":"**$1**",a)}},italic:{title:"Italic",label:'<i class="uk-icon-italic"></i>',action:function(a){e("html"==this.getMode()?"<em>$1</em>":"*$1*",a)}},strike:{title:"Strikethrough",label:'<i class="uk-icon-strikethrough"></i>',action:function(a){e("html"==this.getMode()?"<del>$1</del>":"~~$1~~",a)}},blockquote:{title:"Blockquote",label:'<i class="uk-icon-quote-right"></i>',action:function(a){f("html"==this.getMode()?"<blockquote><p>$1</p></blockquote>":"> $1",a)}},link:{title:"Link",label:'<i class="uk-icon-link"></i>',action:function(a){e("html"==this.getMode()?'<a href="http://">$1</a>':"[$1](http://)",a)}},picture:{title:"Picture",label:'<i class="uk-icon-picture-o"></i>',action:function(a){e("html"==this.getMode()?'<img src="http://" alt="$1">':"![$1](http://)",a)}},listUl:{title:"Unordered List",label:'<i class="uk-icon-list-ul"></i>',action:function(a){f("html"==this.getMode()?"<li>$1</li>":"* $1",a)}},listOl:{title:"Ordered List",label:'<i class="uk-icon-list-ol"></i>',action:function(a){f("html"==this.getMode()?"<li>$1</li>":"* $1",a)}}},d.defaults={mode:"split",markdown:!1,autocomplete:!0,height:500,plugins:[],maxsplitsize:1e3,markedOptions:{gfm:!0,tables:!0,breaks:!0,pedantic:!0,sanitize:!1,smartLists:!0,smartypants:!1,langPrefix:"lang-"},codemirror:{mode:"htmlmixed",tabMode:"indent",tabindex:"4",lineWrapping:!0,dragDrop:!1,autoCloseTags:!0,matchTags:!0,autoCloseBrackets:!0,matchBrackets:!0},toolbar:["bold","italic","strike","link","picture","blockquote","listUl","listOl"],lblPreview:"Preview",lblCodeview:"HTML"},d.template='<div class="uk-htmleditor uk-clearfix" data-mode="split"><div class="uk-htmleditor-navbar"><ul class="uk-htmleditor-navbar-nav uk-htmleditor-toolbar"></ul><div class="uk-htmleditor-navbar-flip"><ul class="uk-htmleditor-navbar-nav"><li class="uk-htmleditor-button-code"><a>{:lblCodeview}</a></li><li class="uk-htmleditor-button-preview"><a>{:lblPreview}</a></li><li><a data-htmleditor-cmd="fullscreen"><i class="uk-icon-expand"></i></a></li></ul></div></div><div class="uk-htmleditor-content"><div class="uk-htmleditor-code"></div><div class="uk-htmleditor-preview"><div></div></div></div></div>',d.plugins={},d.addPlugin=function(a,b,c){d.plugins[a]={identifier:b,cb:c}},c.htmleditor=d,b(function(){b("textarea[data-uk-htmleditor]").each(function(){var a,e=b(this);e.data("htmleditor")||(a=new d(e,c.Utils.options(e.attr("data-uk-htmleditor"))))})}),d});